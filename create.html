<!DOCTYPE html>
<html>
<head>
    <title>Hello!</title>
</head>
<body style="text-align: center; font-family: 'Lucida Sans', Arial, sans-serif;">
<h1>Speak</h1>
<p>"My voice is my password, answer me."</p>
<button id="rec" style="background-color: skyblue; padding: 16px 48px;">Start Recording</button>
<script>
var stop = false;

function stopRec(){
    stop = true;
    console.log("d");
}

// appends an audio element to playback and download recording
function createAudioElement(blobUrl) {
    const downloadEl = document.createElement('a');
    downloadEl.style = 'display: block';
    downloadEl.innerHTML = 'Save file?';
    downloadEl.download = 'audio.webm';
    downloadEl.href = blobUrl;
    const audioEl = document.createElement('audio');
    audioEl.controls = true;
    const sourceEl = document.createElement('source');
    sourceEl.src = blobUrl;
    sourceEl.type = 'audio/webm';
    audioEl.appendChild(sourceEl);
    document.body.appendChild(audioEl);
    document.body.appendChild(downloadEl);
}

// request permission to access audio stream
navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
    // store streaming data chunks in array
    console.log("3");
    
    const chunks = [];
    const recorder = new MediaRecorder(stream);

    // create media recorder instance to initialize recording
    console.log("3");
    // function to be called when data is received
    recorder.ondataavailable = e => {
      // add stream data to chunks
      chunks.push(e.data);
      // if recorder is 'inactive' then recording has finished
      if (recorder.state == 'inactive') {
          // convert stream data chunks to a 'webm' audio format as a blob
          const blob = new Blob(chunks, { type: 'audio/webm' });
          // convert blob to URL so it can be assigned to a audio src attribute
          createAudioElement(URL.createObjectURL(blob));
      }
    };    
    document.getElementById('rec').addEventListener('click', function (event) {
        recorder.start(0);
        document.getElementById('rec').innerHTML = 'Stop Recording';
        document.getElementById('rec').style.backgroundColor = 'red';
        document.getElementById('rec').addEventListener('click', function (event) {
            document.getElementById('rec').style.display = 'none';
            recorder.stop();
        }, false);
    }, false);

    console.log("u");

  }).catch(console.error);

const http = require('http');

const hostname = '127.0.0.1';
const port = 3000;

const server = http.createServer((req, res) => {
  res.statusCode = 200;
  res.setHeader('Content-Type', 'text/plain');
  res.end('Hello World\n');
});

server.listen(port, hostname, () => {
  console.log(`Server running at http://${hostname}:${port}/`);
});
</script>
</body>
</html>